#!/usr/bin/env python3
"""Run the project's test suite via pytest."""

import os
import subprocess
import sys
from pathlib import Path

ROOT_DIR = Path(__file__).resolve().parent
DEFAULT_ENV = {
    "DATABASE_URL": "sqlite:///:memory:",
    "SESSION_SECRET": "test-secret-key",
}


def main(args: list[str]) -> int:
    env = os.environ.copy()
    for key, value in DEFAULT_ENV.items():
        env.setdefault(key, value)

    cmd = [sys.executable, "-m", "pytest", *args]
    return subprocess.call(cmd, cwd=str(ROOT_DIR), env=env)


if __name__ == "__main__":
    raise SystemExit(main(sys.argv[1:]))
