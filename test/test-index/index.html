<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Test Index Validation</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; line-height: 1.6; }
    a { color: #0366d6; text-decoration: none; }
    a:hover { text-decoration: underline; }
    pre { background: #f6f8fa; padding: 1rem; border-radius: 6px; overflow-x: auto; }
    .pylint-output { background: #f6f8fa; padding: 1rem; border-radius: 6px; overflow-x: auto; font-family: monospace; white-space: pre-wrap; word-wrap: break-word; }
    .warning { background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; padding: 1rem; margin: 1rem 0; }
    .warning strong { color: #856404; }
    .warning ul { margin-top: 0.5rem; margin-bottom: 0.5rem; }
  </style>
</head>
<body>
  <h1>Test Index Validation</h1>
  <p><a href="TEST_INDEX.md">View TEST_INDEX.md</a></p>
  <h2>Summary</h2><ul><li>Tests indexed: 6404</li><li>Exit code: 1</li><li>Status: âœ— Index validation failed</li></ul>
  <h2>Validation output</h2>
  <pre>Scanning for unit tests...
Found 5577 unit tests
Scanning for integration tests...
Found 590 integration tests
Scanning for property tests...
Found 84 property tests
Scanning for Gauge tests...
Found 153 Gauge scenarios

Total tests found: 6404

Test index written to TEST_INDEX.md
--- /tmp/tmp.ss4XF4T3X0	2026-01-11 18:37:46.984867936 +0000
+++ TEST_INDEX.md	2026-01-11 18:37:46.962867765 +0000
@@ -2,15 +2,15 @@
 
 This index lists all tests in the project, organized by type.
 
-**Total Tests:** 6116
-- Unit Tests: 5359
+**Total Tests:** 6404
+- Unit Tests: 5577
 - Integration Tests: 590
-- Property Tests: 14
+- Property Tests: 84
 - Gauge Tests: 153
 
 ## Unit Tests
 
-Total: 5359 tests
+Total: 5577 tests
 
 - [Test that pending calls are cleared after being used.](tests/test_ai_eval_reports.py:87)
 - [Test that __call__ uses pending external calls from call_with_capture.](tests/test_ai_eval_reports.py:68)
@@ -345,6 +345,24 @@
 - [Test payload property for hash-based CID.](tests/test_cid_class.py:213)
 - [Test payload property for literal CID.](tests/test_cid_class.py:207)
 - [Test value property returns normalized CID.](tests/test_cid_class.py:161)
+- [Test creating a CID resolver instance.](tests/test_gateway_cid_resolver.py:17)
+- [Test that resolver adds leading slash for database lookup.](tests/test_gateway_cid_resolver.py:64)
+- [Test converting bytes data to string when as_bytes=False.](tests/test_gateway_cid_resolver.py:150)
+- [Test converting string data to bytes when as_bytes=True.](tests/test_gateway_cid_resolver.py:138)
+- [Test resolving content that is directly bytes (no file_data or data attribute).](tests/test_gateway_cid_resolver.py:181)
+- [Test resolving content that is directly a string.](tests/test_gateway_cid_resolver.py:190)
+- [Test resolving CID from database as bytes.](tests/test_gateway_cid_resolver.py:52)
+- [Test resolving CID from database with data attribute.](tests/test_gateway_cid_resolver.py:40)
+- [Test resolving CID from database with file_data attribute.](tests/test_gateway_cid_resolver.py:28)
+- [Test resolving from filesystem as bytes.](tests/test_gateway_cid_resolver.py:109)
+- [Test resolving from filesystem path.](tests/test_gateway_cid_resolver.py:95)
+- [Test that resolver handles database exceptions gracefully.](tests/test_gateway_cid_resolver.py:86)
+- [Test that resolver handles None CID value gracefully.](tests/test_gateway_cid_resolver.py:209)
+- [Test that resolver doesn&#x27;t cache results.](tests/test_gateway_cid_resolver.py:161)
+- [Test that resolver preserves existing leading slash.](tests/test_gateway_cid_resolver.py:75)
+- [Test that resolve returns None for CID that doesn&#x27;t exist anywhere.](tests/test_gateway_cid_resolver.py:22)
+- [Test that leading slash is stripped for filesystem lookup.](tests/test_gateway_cid_resolver.py:123)
+- [Test resolving Unicode content.](tests/test_gateway_cid_resolver.py:199)
 - [TestCIDSArchive.test_cids_archive_file_exists](tests/test_gateway_test_support.py:188)
 - [TestCIDSArchive.test_cids_archive_format](tests/test_gateway_test_support.py:192)
 - [Test that CID can have extensions for MIME types.](tests/test_cids_server.py:149)
@@ -470,11 +488,16 @@
 - [Test that calling with allowed=True raises ValueError.](tests/test_authorization_handler.py:122)
 - [Test plain text error response for 401.](tests/test_authorization_handler.py:49)
 - [Test plain text error response for 403.](tests/test_authorization_handler.py:64)
-- [Test creating PR when branch already exists.](tests/test_github_pr_integration.py:180)
-- [Test creating PR with invalid repo format.](tests/test_github_pr_integration.py:167)
-- [Test creating PR without token returns manual preparation result.](tests/test_github_pr_integration.py:150)
-- [Test successfully creating a PR.](tests/test_github_pr_integration.py:97)
-- [Test creating PR when file already exists (update instead of create).](tests/test_github_pr_integration.py:221)
+- [Test creating PR when branch already exists.](tests/test_github_pr_integration.py:197)
+- [Test creating PR with invalid repo format.](tests/test_github_pr_integration.py:184)
+- [Test creating PR without token returns manual preparation result.](tests/test_github_pr_integration.py:167)
+- [Test successfully creating a PR.](tests/test_github_pr_integration.py:114)
+- [Test creating PR when file already exists (update instead of create).](tests/test_github_pr_integration.py:238)
+- [TestCreateGatewayRouter.test_creates_router_with_all_routes](tests/test_gateway_routing.py:139)
+- [Gateway request routes handle server with and without path.](tests/test_gateway_routing.py:222)
+- [Meta test pattern checked before general meta.](tests/test_gateway_routing.py:182)
+- [Servers named &#x27;meta&#x27;, &#x27;request&#x27;, &#x27;response&#x27;, or &#x27;test&#x27; are shadowed.](tests/test_gateway_routing.py:157)
+- [Test routes handle both with and without rest path.](tests/test_gateway_routing.py:202)
 - [Test require_one_of when both secrets are present.](tests/test_credential_validator.py:82)
 - [Test require_one_of when first secret is present.](tests/test_credential_validator.py:66)
 - [Test require_one_of with multiple options.](tests/test_credential_validator.py:101)
@@ -619,6 +642,11 @@
 - [TestDefinitionUtility.test_ensure_primary_line_preserves_existing_mapping](tests/test_alias_definition.py:309)
 - [TestDefinitionUtility.test_replace_primary_definition_line_appends_when_missing](tests/test_alias_definition.py:337)
 - [TestDefinitionUtility.test_replace_primary_definition_line_preserves_indentation](tests/test_alias_definition.py:317)
+- [Test with empty traceback.](tests/test_gateway_diagnostic.py:53)
+- [Test with None input.](tests/test_gateway_diagnostic.py:58)
+- [Test with traceback without colon in last line.](tests/test_gateway_diagnostic.py:68)
+- [Test deriving exception from valid traceback.](tests/test_gateway_diagnostic.py:41)
+- [Test with whitespace-only traceback.](tests/test_gateway_diagnostic.py:63)
 - [TestDescribeFunctionParameters.test_describe_main_function_parameters](tests/test_server_execution.py:219)
 - [TestDescribeFunctionParameters.test_describes_simple_function](tests/test_server_execution.py:200)
 - [TestDescribeFunctionParameters.test_returns_none_for_unsupported_signature](tests/test_server_execution.py:211)
@@ -633,6 +661,8 @@
 - [TypeScript suffix returns typescript.](tests/test_pipeline_execution.py:38)
 - [Text suffix should raise data error.](tests/test_pipeline_execution.py:67)
 - [Unrecognized suffix should raise error.](tests/test_pipeline_execution.py:50)
+- [Test creating direct response.](tests/test_gateway_models.py:197)
+- [Test direct response with custom fields.](tests/test_gateway_models.py:205)
 - [Test that echo server generates correct CID redirect URL](tests/test_echo_functionality.py:150)
 - [Test that echo server works when properly created](tests/test_echo_functionality.py:69)
 - [Test that no &#x27;echo&#x27; server exists in the database](tests/test_echo_functionality.py:44)
@@ -762,6 +792,10 @@
 - [TestExtractChainedOutput.test_extracts_from_dict](tests/test_server_execution.py:92)
 - [TestExtractChainedOutput.test_extracts_from_json_string](tests/test_server_execution.py:98)
 - [TestExtractChainedOutput.test_passthrough_for_non_json_string](tests/test_server_execution.py:102)
+- [Test with empty HTML.](tests/test_gateway_diagnostic.py:96)
+- [Test with HTML without exception marker.](tests/test_gateway_diagnostic.py:90)
+- [Test with None input.](tests/test_gateway_diagnostic.py:101)
+- [Test extracting from valid error HTML.](tests/test_gateway_diagnostic.py:79)
 - [Test extracting filename from CID path.](tests/test_mime_utils.py:99)
 - [Test filenames with multiple dots.](tests/test_mime_utils.py:115)
 - [Test CID with only extension (no filename).](tests/test_mime_utils.py:107)
@@ -792,9 +826,12 @@
 - [TestExtractRequestBodyValues.test_extracts_form_data](tests/test_server_execution.py:315)
 - [TestExtractRequestBodyValues.test_extracts_json_payload](tests/test_server_execution.py:309)
 - [TestExtractRequestBodyValues.test_handles_empty_request](tests/test_server_execution.py:321)
-- [PRs created by the new workflow touch boot source files; import remains legacy.](tests/test_github_pr_integration.py:314)
-- [Test fetching PR with invalid URL.](tests/test_github_pr_integration.py:344)
-- [Test successfully fetching PR export data.](tests/test_github_pr_integration.py:274)
+- [Test with None input.](tests/test_gateway_diagnostic.py:134)
+- [Test extracting stack trace from error HTML.](tests/test_gateway_diagnostic.py:110)
+- [Test with HTML without ol tag.](tests/test_gateway_diagnostic.py:128)
+- [PRs created by the new workflow touch boot source files; import remains legacy.](tests/test_github_pr_integration.py:331)
+- [Test fetching PR with invalid URL.](tests/test_github_pr_integration.py:361)
+- [Test successfully fetching PR export data.](tests/test_github_pr_integration.py:291)
 - [Server events page should list invocation details and required links.](tests/test_routes_comprehensive.py:1331)
 - [Uploading identical content reuses the existing CID instead of creating a duplicate record.](tests/test_routes_comprehensive.py:1206)
 - [GET /upload returns HTTP 200 and renders the text AI input markup.](tests/test_routes_comprehensive.py:1161)
@@ -828,6 +865,11 @@
 - [Plain text starts with header.](tests/test_pipeline_debug.py:383)
 - [Plain text shows segment information.](tests/test_pipeline_debug.py:407)
 - [Plain text shows status.](tests/test_pipeline_debug.py:391)
+- [Test formatting with debug context.](tests/test_gateway_diagnostic.py:211)
+- [Test formatting exception details.](tests/test_gateway_diagnostic.py:203)
+- [Test formatting custom exception.](tests/test_gateway_diagnostic.py:28)
+- [Test formatting exception with message.](tests/test_gateway_diagnostic.py:16)
+- [Test formatting exception without message.](tests/test_gateway_diagnostic.py:22)
 - [TestFormatPrimaryAliasLine.test_formats_flask_match](tests/test_alias_definition.py:516)
 - [TestFormatPrimaryAliasLine.test_formats_glob_match](tests/test_alias_definition.py:508)
 - [TestFormatPrimaryAliasLine.test_formats_literal_match_with_pattern](tests/test_alias_definition.py:504)
@@ -842,6 +884,13 @@
 - [TestFormdownIntegration.test_formdown_fence_renders_form_component](tests/test_markdown_rendering.py:218)
 - [TestFormdownIntegration.test_formdown_file_fields_enable_multipart_submission](tests/test_markdown_rendering.py:257)
 - [TestFormdownIntegration.test_plain_markdown_has_no_formdown_markup](tests/test_markdown_rendering.py:252)
+- [Test creating gateway config with all fields.](tests/test_gateway_models.py:27)
+- [Test creating gateway config with only required fields.](tests/test_gateway_models.py:17)
+- [TestGatewayRouter.test_first_match_wins](tests/test_gateway_routing.py:93)
+- [TestGatewayRouter.test_multiple_routes_in_order](tests/test_gateway_routing.py:125)
+- [TestGatewayRouter.test_route_no_match_raises_error](tests/test_gateway_routing.py:118)
+- [TestGatewayRouter.test_route_strips_leading_trailing_slashes](tests/test_gateway_routing.py:111)
+- [TestGatewayRouter.test_route_with_captured_params](tests/test_gateway_routing.py:101)
 - [Test that generate() returns gateways_cid in result.](tests/test_generate_boot_image.py:780)
 - [Test that gateways are included in default.boot.json.](tests/test_generate_boot_image.py:726)
 - [Test that gateways are included in readonly.boot.json.](tests/test_generate_boot_image.py:748)
@@ -1156,6 +1205,20 @@
 - [Test that /meta returns server info when CID is a server definition.](tests/test_meta_route.py:490)
 - [Test that /meta returns enhanced server metadata for urleditor.](tests/test_meta_route.py:470)
 - [Test that /meta/{CID} works for CID literal requests.](tests/test_meta_route.py:512)
+- [TestMiddleware.test_after_request_default_returns_result](tests/test_gateway_middleware.py:18)
+- [TestMiddleware.test_before_request_default_returns_context](tests/test_gateway_middleware.py:12)
+- [TestMiddleware.test_on_error_default_does_nothing](tests/test_gateway_middleware.py:25)
+- [TestMiddlewareChain.test_empty_chain_returns_context_unchanged](tests/test_gateway_middleware.py:73)
+- [TestMiddlewareChain.test_empty_chain_returns_result_unchanged](tests/test_gateway_middleware.py:79)
+- [Middleware can see modifications made by previous middleware.](tests/test_gateway_middleware.py:210)
+- [Multiple middleware can transform context.](tests/test_gateway_middleware.py:153)
+- [Multiple middleware can transform result.](tests/test_gateway_middleware.py:175)
+- [Middleware executes in reverse order for after_request.](tests/test_gateway_middleware.py:134)
+- [Middleware executes in added order for before_request.](tests/test_gateway_middleware.py:119)
+- [All middleware on_error handlers are called.](tests/test_gateway_middleware.py:196)
+- [TestMiddlewareChain.test_single_middleware_after_request](tests/test_gateway_middleware.py:97)
+- [TestMiddlewareChain.test_single_middleware_before_request](tests/test_gateway_middleware.py:86)
+- [TestMiddlewareChain.test_single_middleware_on_error](tests/test_gateway_middleware.py:108)
 - [TestMissingParameterError.test_formats_error_message](tests/test_server_execution.py:754)
 - [TestMissingParameterError.test_stores_missing_parameters](tests/test_server_execution.py:749)
 - [Test that CID.filename.ext paths get content disposition](tests/test_content_disposition.py:189)
@@ -1169,6 +1232,12 @@
 - [Test that onupdate datetime fields work correctly.](tests/test_models.py:138)
 - [TestNamedValueResolver.test_resolve_many_and_available_sources](tests/test_server_execution.py:433)
 - [TestNamedValueResolver.test_resolver_prioritises_request_sources](tests/test_server_execution.py:411)
+- [Test that empty string returns None.](tests/test_gateway_normalizer.py:13)
+- [Test that None input returns None.](tests/test_gateway_normalizer.py:9)
+- [Test normalization of path without leading slash.](tests/test_gateway_normalizer.py:32)
+- [Test that leading slash is preserved.](tests/test_gateway_normalizer.py:27)
+- [Test that whitespace is stripped.](tests/test_gateway_normalizer.py:22)
+- [Test that whitespace-only string returns None.](tests/test_gateway_normalizer.py:17)
 - [Test normalizing empty string.](tests/test_cid_core.py:56)
 - [Test normalizing None.](tests/test_cid_core.py:52)
 - [Test normalizing string with internal slash returns empty.](tests/test_cid_core.py:69)
@@ -1287,13 +1356,20 @@
 - [TestParseFunctionDetails.test_detects_vararg](tests/test_server_execution.py:134)
 - [TestParseFunctionDetails.test_parses_keyword_only_params](tests/test_server_execution.py:122)
 - [TestParseFunctionDetails.test_parses_simple_function](tests/test_server_execution.py:109)
-- [Test parsing URL with invalid hostname.](tests/test_github_pr_integration.py:47)
-- [Test parsing URL with invalid path.](tests/test_github_pr_integration.py:56)
-- [Test parsing URL with non-numeric PR number.](tests/test_github_pr_integration.py:74)
-- [Test parsing malformed URL.](tests/test_github_pr_integration.py:83)
-- [Test parsing URL missing PR number.](tests/test_github_pr_integration.py:65)
-- [Test parsing a valid GitHub PR URL.](tests/test_github_pr_integration.py:29)
-- [Test parsing a valid GitHub PR URL with www.](tests/test_github_pr_integration.py:38)
+- [Test parsing URL with invalid hostname.](tests/test_github_pr_integration.py:64)
+- [Test parsing URL with invalid path.](tests/test_github_pr_integration.py:73)
+- [Test parsing URL with non-numeric PR number.](tests/test_github_pr_integration.py:91)
+- [Test parsing malformed URL.](tests/test_github_pr_integration.py:100)
+- [Test parsing URL missing PR number.](tests/test_github_pr_integration.py:82)
+- [Test parsing a valid GitHub PR URL.](tests/test_github_pr_integration.py:46)
+- [Test parsing a valid GitHub PR URL with www.](tests/test_github_pr_integration.py:55)
+- [Test parsing path with archive and file path.](tests/test_gateway_normalizer.py:41)
+- [Test parsing path with archive only.](tests/test_gateway_normalizer.py:47)
+- [Test parsing empty string.](tests/test_gateway_normalizer.py:53)
+- [Test parsing path with leading slash.](tests/test_gateway_normalizer.py:65)
+- [Test parsing path with multiple slashes.](tests/test_gateway_normalizer.py:77)
+- [Test parsing None.](tests/test_gateway_normalizer.py:59)
+- [Test parsing path with trailing slash (strips trailing slashes).](tests/test_gateway_normalizer.py:71)
 - [Empty path returns empty list.](tests/test_io_execution.py:70)
 - [/io//server ignores empty segments.](tests/test_io_execution.py:95)
 - [Path with only /io returns empty list.](tests/test_io_execution.py:75)
@@ -1329,10 +1405,10 @@
 - [Test that /s1/p1/s2/p2 correctly binds params to adjacent servers. - p1 binds to s1 (p1 is to the right of s1) - p2 binds to s2 (p2 is to the right of s2)](tests/test_pipeline_parameter_binding.py:160)
 - [Test that /echo/hello means echo receives literal &#x27;hello&#x27;. The rightmost segment is executed first in pipeline mode. If it&#x27;s a parameter (literal), its value is used as input.](tests/test_pipeline_parameter_binding.py:215)
 - [Test that /server/param passes param to server. In /echo/hello: - &#x27;echo&#x27; is the server - &#x27;hello&#x27; is a parameter that should be passed to echo](tests/test_pipeline_parameter_binding.py:100)
-- [Test fetching PR with invalid JSON content.](tests/test_github_pr_integration.py:539)
-- [Test fetching non-existent PR.](tests/test_github_pr_integration.py:484)
-- [Test fetching PR that doesn&#x27;t modify the boot image file.](tests/test_github_pr_integration.py:509)
-- [TestPrepareBootImageUpdate.test_prepare_boot_image_update_materializes_cids_and_does_not_write_generated_outputs](tests/test_github_pr_integration.py:356)
+- [Test fetching PR with invalid JSON content.](tests/test_github_pr_integration.py:556)
+- [Test fetching non-existent PR.](tests/test_github_pr_integration.py:501)
+- [Test fetching PR that doesn&#x27;t modify the boot image file.](tests/test_github_pr_integration.py:526)
+- [TestPrepareBootImageUpdate.test_prepare_boot_image_update_materializes_cids_and_does_not_write_generated_outputs](tests/test_github_pr_integration.py:373)
 - [Test building a basic preview.](tests/test_preview_builder.py:11)
 - [Test wrapping preview in dry-run response.](tests/test_preview_builder.py:109)
 - [Test that sensitive headers are redacted.](tests/test_preview_builder.py:66)
@@ -1424,6 +1500,9 @@
 - [Test that empty external calls returns empty string.](tests/test_ai_eval_reports.py:222)
 - [Test formatting multiple external calls.](tests/test_ai_eval_reports.py:232)
 - [TestRequestDetails.test_collects_request_details](tests/test_server_execution.py:568)
+- [Test creating request details with all fields.](tests/test_gateway_models.py:59)
+- [Test creating request details with only path.](tests/test_gateway_models.py:48)
+- [Test building RequestDetails from parameters.](tests/test_gateway_models.py:78)
 - [Non-alias segment returns empty list.](tests/test_pipeline_execution.py:256)
 - [Single alias resolution tracked.](tests/test_pipeline_execution.py:263)
 - [First path segment should be extracted as script arg.](tests/test_bash_path_parameters.py:84)
@@ -1442,6 +1521,9 @@
 - [Disabled server is not detected as server.](tests/test_pipeline_execution.py:180)
 - [Detect segment as named server.](tests/test_pipeline_execution.py:170)
 - [Detect segment as parameter when nothing else matches.](tests/test_pipeline_execution.py:211)
+- [Test creating response details.](tests/test_gateway_models.py:93)
+- [Test direct response flag.](tests/test_gateway_models.py:121)
+- [Test response with JSON data.](tests/test_gateway_models.py:110)
 - [Test handling of large response body.](tests/test_response_handler.py:309)
 - [Test deeply nested error response.](tests/test_response_handler.py:284)
 - [Test response with null values.](tests/test_response_handler.py:274)
@@ -1453,6 +1535,22 @@
 - [Convert empty result.](tests/test_pipeline_debug.py:151)
 - [Convert failed result with error message.](tests/test_pipeline_debug.py:188)
 - [Convert result with segments.](tests/test_pipeline_debug.py:162)
+- [TestRoute.test_empty_pattern_does_not_match_non_empty_path](tests/test_gateway_routing.py:18)
+- [TestRoute.test_empty_pattern_matches_empty_path](tests/test_gateway_routing.py:14)
+- [TestRoute.test_exact_multi_segment_match](tests/test_gateway_routing.py:30)
+- [TestRoute.test_exact_multi_segment_no_match](tests/test_gateway_routing.py:34)
+- [TestRoute.test_exact_string_match](tests/test_gateway_routing.py:22)
+- [TestRoute.test_exact_string_no_match](tests/test_gateway_routing.py:26)
+- [TestRoute.test_greedy_path_variable](tests/test_gateway_routing.py:53)
+- [TestRoute.test_greedy_path_variable_empty](tests/test_gateway_routing.py:63)
+- [TestRoute.test_greedy_path_variable_single_segment](tests/test_gateway_routing.py:58)
+- [TestRoute.test_greedy_with_trailing_segments](tests/test_gateway_routing.py:73)
+- [TestRoute.test_mixed_literal_and_greedy_path](tests/test_gateway_routing.py:68)
+- [TestRoute.test_mixed_literal_and_variable](tests/test_gateway_routing.py:48)
+- [TestRoute.test_multiple_variable_capture](tests/test_gateway_routing.py:43)
+- [TestRoute.test_segment_count_mismatch](tests/test_gateway_routing.py:78)
+- [TestRoute.test_single_variable_capture](tests/test_gateway_routing.py:38)
+- [Test that {var:path} extracts &#x27;var&#x27; as the parameter name.](tests/test_gateway_routing.py:83)
 - [TestRoutesOverview.test_frontend_filtering_orders_exact_partial_and_not_found](tests/test_routes_overview.py:96)
 - [TestRoutesOverview.test_lists_builtin_alias_and_server_routes](tests/test_routes_overview.py:45)
 - [TestRoutesOverview.test_requires_login](tests/test_routes_overview.py:41)
@@ -1483,6 +1581,10 @@
 - [Test TypeError when argmap is not a dict.](tests/test_text_function_runner.py:152)
 - [Test TypeError when body_text is not a string.](tests/test_text_function_runner.py:147)
 - [Common typing aliases should be preloaded for convenience.](tests/test_text_function_runner.py:133)
+- [Test that lowercase header names are also removed.](tests/test_gateway_diagnostic.py:171)
+- [Test that other fields are preserved.](tests/test_gateway_diagnostic.py:185)
+- [Test that authorization headers are removed.](tests/test_gateway_diagnostic.py:143)
+- [Test that cookie headers are removed.](tests/test_gateway_diagnostic.py:157)
 - [The 404 page should offer shortcuts for creating aliases, servers, variables, and secrets.](tests/test_routes_comprehensive.py:1053)
 - [Aliases should be able to use names that previously had placeholder 404 routes.](tests/test_routes_comprehensive.py:986)
 - [TestSearchApi.test_alias_named_privacy_can_be_resolved](tests/test_routes_comprehensive.py:1031)
@@ -1656,6 +1758,10 @@
 - [Test that default prompt is returned when no AI_SYSTEM_PROMPTS configured.](tests/test_ai_system_prompts.py:44)
 - [Test that default prompt is used when request has no path.](tests/test_ai_system_prompts.py:76)
 - [Test that URL fragments match as prefixes.](tests/test_ai_system_prompts.py:96)
+- [Test creating internal target.](tests/test_gateway_models.py:170)
+- [Test validating internal target.](tests/test_gateway_models.py:176)
+- [Test validation rejects external mode.](tests/test_gateway_models.py:181)
+- [Test validation rejects external URL.](tests/test_gateway_models.py:187)
 - [Test getting specific template by key.](tests/test_template_manager.py:316)
 - [Test getting template with invalid entity type.](tests/test_template_manager.py:344)
 - [Test getting non-existent template by key.](tests/test_template_manager.py:331)
@@ -1699,6 +1805,9 @@
 - [Timestamp ordering is equivalent in both databases.](tests/test_db_edge_cases_equivalence.py:188)
 - [Nested transaction behavior is equivalent.](tests/test_db_edge_cases_equivalence.py:37)
 - [Rollback behavior is equivalent in both databases.](tests/test_db_edge_cases_equivalence.py:16)
+- [Test creating transform result.](tests/test_gateway_models.py:138)
+- [Test transform result with bytes output.](tests/test_gateway_models.py:146)
+- [Test transform result with custom headers.](tests/test_gateway_models.py:155)
 - [Test counting UIs for an entity.](tests/test_ui_manager.py:354)
 - [Test parsing uis from CID reference.](tests/test_ui_manager.py:99)
 - [Test parsing uis from CID reference with leading slash.](tests/test_ui_manager.py:124)
@@ -1846,6 +1955,7 @@
 - [test_add_member_requires_list_id_and_email](tests/test_external_server_mailchimp.py:36)
 - [test_add_profile_to_list_requires_both_ids](tests/test_external_server_klaviyo.py:50)
 - [test_admonition_renders_with_title_and_body](tests/test_markdown_rendering.py:83)
+- [test_after_request_default_returns_result](tests/test_gateway_middleware.py:18)
 - [test_ai_alias_created_when_missing](tests/test_ai_stub_server.py:40)
 - [test_ai_alias_definition_can_be_updated_by_user](tests/test_ai_stub_server.py:66)
 - [test_ai_alias_preserved_when_already_defined](tests/test_ai_stub_server.py:53)
@@ -2021,6 +2131,7 @@
 - [Convert basic segment info.](tests/test_pipeline_debug.py:49)
 - [test_batch_update_requires_document_id](tests/test_external_server_google_docs.py:28)
 - [test_batch_update_requires_requests_payload](tests/test_external_server_google_docs.py:33)
+- [test_before_request_default_returns_context](tests/test_gateway_middleware.py:12)
 - [Test generating CID from binary content.](tests/test_cid_class.py:380)
 - [Test that binary content that&#x27;s not valid UTF-8 returns None for content_text.](tests/test_cid_editor_helper.py:95)
 - [Test that boot.cid exists and has valid content.](tests/test_main.py:22)
@@ -2311,6 +2422,7 @@
 - [test_create_customer_success](tests/test_external_server_helpscout.py:216)
 - [test_create_deal_requires_data](tests/test_external_server_pipedrive.py:31)
 - [Test that delete route has correct function name.](tests/test_crud_factory.py:229)
+- [Test creating direct response.](tests/test_gateway_models.py:197)
 - [test_create_document_requires_name](tests/test_external_server_pandadoc.py:65)
 - [test_create_document_requires_recipient_email](tests/test_external_server_pandadoc.py:84)
 - [test_create_document_requires_template_uuid](tests/test_external_server_pandadoc.py:74)
@@ -2328,7 +2440,10 @@
 - [test_create_form_requires_title](tests/test_external_server_google_forms.py:23)
 - [test_create_form_requires_title](tests/test_external_server_jotform.py:29)
 - [test_create_form_requires_title](tests/test_external_server_typeform.py:29)
+- [Test creating gateway config with all fields.](tests/test_gateway_models.py:27)
+- [Test creating request details with all fields.](tests/test_gateway_models.py:59)
 - [Creating an entity interaction produces equivalent results.](tests/test_db_equivalence.py:337)
+- [Test creating internal target.](tests/test_gateway_models.py:170)
 - [Creating a server invocation produces equivalent results.](tests/test_db_equivalence.py:368)
 - [test_create_issue_dry_run](tests/test_external_server_gitlab.py:116)
 - [test_create_issue_requires_title](tests/test_external_server_github.py:60)
@@ -2350,6 +2465,8 @@
 - [test_create_listing_requires_title](tests/test_external_server_etsy.py:73)
 - [test_create_listing_success](tests/test_external_server_etsy.py:121)
 - [test_create_meeting_requires_meeting_data](tests/test_external_server_zoom.py:29)
+- [Test creating gateway config with only required fields.](tests/test_gateway_models.py:17)
+- [Test creating request details with only path.](tests/test_gateway_models.py:48)
 - [test_create_operation_requires_data](tests/test_external_server_freshbooks.py:46)
 - [test_create_operation_requires_data](tests/test_external_server_xero.py:56)
 - [test_create_operation_requires_entity_type_and_data](tests/test_external_server_quickbooks.py:53)
@@ -2360,11 +2477,11 @@
 - [test_create_page_view_record_reflects_request_details](tests/test_analytics.py:108)
 - [test_create_post_dry_run](tests/test_external_server_wordpress.py:92)
 - [test_create_post_requires_title](tests/test_external_server_wordpress.py:80)
-- [Test creating PR when branch already exists.](tests/test_github_pr_integration.py:180)
-- [Test creating PR with invalid repo format.](tests/test_github_pr_integration.py:167)
-- [Test creating PR without token returns manual preparation result.](tests/test_github_pr_integration.py:150)
-- [Test successfully creating a PR.](tests/test_github_pr_integration.py:97)
-- [Test creating PR when file already exists (update instead of create).](tests/test_github_pr_integration.py:221)
+- [Test creating PR when branch already exists.](tests/test_github_pr_integration.py:197)
+- [Test creating PR with invalid repo format.](tests/test_github_pr_integration.py:184)
+- [Test creating PR without token returns manual preparation result.](tests/test_github_pr_integration.py:167)
+- [Test successfully creating a PR.](tests/test_github_pr_integration.py:114)
+- [Test creating PR when file already exists (update instead of create).](tests/test_github_pr_integration.py:238)
 - [test_create_product_dry_run](tests/test_external_server_squarespace.py:81)
 - [test_create_product_requires_name](tests/test_external_server_woocommerce.py:79)
 - [test_create_product_requires_name_and_price](tests/test_external_server_squarespace.py:63)
@@ -2377,6 +2494,8 @@
 - [test_create_record_requires_sobject_and_data](tests/test_external_server_salesforce.py:57)
 - [test_create_record_success](tests/test_external_server_servicenow.py:84)
 - [test_create_requires_database_and_title](tests/test_external_server_notion.py:58)
+- [Test creating a CID resolver instance.](tests/test_gateway_cid_resolver.py:17)
+- [Test creating response details.](tests/test_gateway_models.py:93)
 - [test_create_row_requires_doc_table_and_data](tests/test_external_server_coda.py:71)
 - [Creating a secret produces equivalent results.](tests/test_db_equivalence.py:197)
 - [Creating a server produces equivalent results.](tests/test_db_equivalence.py:26)
@@ -2392,11 +2511,13 @@
 - [test_create_ticket_requires_subject_description_email](tests/test_external_server_freshdesk.py:70)
 - [test_create_ticket_success](tests/test_external_server_freshdesk.py:182)
 - [test_create_ticket_success](tests/test_external_server_gorgias.py:78)
+- [Test creating transform result.](tests/test_gateway_models.py:138)
 - [Creating a variable produces equivalent results.](tests/test_db_equivalence.py:160)
 - [Test that create_view_route uses the custom parameter name.](tests/test_crud_factory.py:197)
 - [test_create_widget_dry_run](tests/test_external_server_miro.py:176)
 - [test_create_widget_requires_data](tests/test_external_server_miro.py:166)
 - [Test created success message.](tests/test_crud_factory.py:28)
+- [test_creates_router_with_all_routes](tests/test_gateway_routing.py:139)
 - [test_css_alias_created_when_missing](tests/test_css_alias.py:42)
 - [test_css_alias_created_with_expected_definition](tests/test_css_alias.py:33)
 - [test_css_alias_dark_mode_theme_content_changes](tests/test_css_alias.py:176)
@@ -2497,6 +2618,11 @@
 - [test_delete_success_returns_success](tests/test_external_server_salesforce.py:182)
 - [test_delete_task_requires_task_id](tests/test_external_server_cloudconvert.py:84)
 - [Test deleted success message.](tests/test_crud_factory.py:38)
+- [Test with empty traceback.](tests/test_gateway_diagnostic.py:53)
+- [Test with None input.](tests/test_gateway_diagnostic.py:58)
+- [Test with traceback without colon in last line.](tests/test_gateway_diagnostic.py:68)
+- [Test deriving exception from valid traceback.](tests/test_gateway_diagnostic.py:41)
+- [Test with whitespace-only traceback.](tests/test_gateway_diagnostic.py:63)
 - [test_describe_alias_redirect_includes_status_metadata](tests/test_variables_resolution.py:29)
 - [test_describe_main_function_parameters](tests/test_server_execution.py:219)
 - [test_describe_object_requires_sobject](tests/test_external_server_salesforce.py:89)
@@ -2523,6 +2649,8 @@
 - [Test that different body_text produces different function names.](tests/test_text_function_runner.py:98)
 - [Test HRX with different boundary lengths.](tests/test_hrx_parser.py:96)
 - [Exercise every direct-encoding length with multiple examples.](tests/test_cid_generation.py:42)
+- [Test direct response flag.](tests/test_gateway_models.py:121)
+- [Test direct response with custom fields.](tests/test_gateway_models.py:205)
 - [test_directive_expands_and_splits_args](tests/test_bash_path_parameters.py:213)
 - [test_directive_missing_command_returns_error](tests/test_bash_path_parameters.py:256)
 - [test_directive_underscore_sentinel_means_no_args_and_passes_stdin](tests/test_bash_path_parameters.py:234)
@@ -2835,6 +2963,8 @@
 - [test_embeds_payload_from_json_request](tests/test_ai_editor.py:69)
 - [Test empty and invalid paths.](tests/test_mime_utils.py:133)
 - [Test that an empty archive raises an error.](tests/test_hrx_parser.py:69)
+- [test_empty_chain_returns_context_unchanged](tests/test_gateway_middleware.py:73)
+- [test_empty_chain_returns_result_unchanged](tests/test_gateway_middleware.py:79)
 - [Test that empty content CID is literal.](tests/test_cid_core.py:257)
 - [Test CID for empty content.](tests/test_cid_editor_helper.py:46)
 - [Test with empty headers dictionary.](tests/test_preview_builder.py:297)
@@ -2848,6 +2978,8 @@
 - [Empty path is not a pipeline.](tests/test_pipeline_recognition.py:233)
 - [Empty pipeline path returns error.](tests/test_pipeline_execution.py:482)
 - [Empty path returns success with no segments.](tests/test_io_execution.py:238)
+- [test_empty_pattern_does_not_match_non_empty_path](tests/test_gateway_routing.py:18)
+- [test_empty_pattern_matches_empty_path](tests/test_gateway_routing.py:14)
 - [Test with empty payload dictionary.](tests/test_preview_builder.py:285)
 - [Test validation with an empty Python file.](tests/test_validate_import_export_integration.py:302)
 - [Convert empty result.](tests/test_pipeline_debug.py:151)
@@ -2858,7 +2990,7 @@
 - [Test validation of empty string.](tests/test_operation_validator.py:148)
 - [Test that both empty string and None are treated as missing.](tests/test_credential_validator.py:159)
 - [Empty strings and NULL are handled equivalently.](tests/test_db_edge_cases_equivalence.py:110)
-- [Gateway with no templates config should still work.](tests/test_gateway_server.py:616)
+- [Gateway with no templates config should still work.](tests/test_gateway_server.py:617)
 - [Test that empty string is not a CID.](tests/test_cid_editor_helper.py:16)
 - [Should be able to enable read-only mode.](tests/test_readonly_config.py:18)
 - [Test updating enabled field from False to True.](tests/test_enabled_field_persistence.py:246)
@@ -2924,6 +3056,10 @@
 - [Error in segment prevents execution.](tests/test_pipeline_execution.py:517)
 - [test_errors_when_no_tokens_available](tests/test_external_api_oauth.py:117)
 - [Nested evaluation routes through the pipeline compatibility layer.](tests/test_pipeline_feature_flag.py:11)
+- [test_exact_multi_segment_match](tests/test_gateway_routing.py:30)
+- [test_exact_multi_segment_no_match](tests/test_gateway_routing.py:34)
+- [test_exact_string_match](tests/test_gateway_routing.py:22)
+- [test_exact_string_no_match](tests/test_gateway_routing.py:26)
 - [Test limit info when exceeding maximum.](tests/test_limit_validator.py:181)
 - [Test that exception chains are properly displayed with separators.](tests/test_error_page_source_links.py:300)
 - [Test that exception chains are properly displayed in browser.](tests/test_error_pages_e2e.py:127)
@@ -2985,6 +3121,11 @@
 - [Test that CIDs in cid_values are NOT included in required references.](tests/test_boot_cid_importer.py:70)
 - [Test extracting CID references from payload with section references.](tests/test_boot_cid_importer.py:86)
 - [Test extracting empty content.](tests/test_cid_core.py:304)
+- [Test with empty HTML.](tests/test_gateway_diagnostic.py:96)
+- [Test with HTML without exception marker.](tests/test_gateway_diagnostic.py:90)
+- [Test with None input.](tests/test_gateway_diagnostic.py:101)
+- [Test with None input.](tests/test_gateway_diagnostic.py:134)
+- [Test extracting from valid error HTML.](tests/test_gateway_diagnostic.py:79)
 - [Test extracting content from empty CID.](tests/test_cid_class.py:224)
 - [Test extracting content from hash-based CID returns None.](tests/test_cid_class.py:234)
 - [Test extracting content from literal CID.](tests/test_cid_class.py:229)
@@ -2992,6 +3133,8 @@
 - [test_extract_references_from_target_detects_server_and_cid](tests/test_entity_references.py:82)
 - [test_extract_references_from_text](tests/test_entity_references.py:64)
 - [Test extracting small content.](tests/test_cid_core.py:311)
+- [Test extracting stack trace from error HTML.](tests/test_gateway_diagnostic.py:110)
+- [Test with HTML without ol tag.](tests/test_gateway_diagnostic.py:128)
 - [Should extract content and Content-Encoding header from response.](tests/test_external_api_content_decoder.py:122)
 - [test_extracts_dict_with_output_and_content_type](tests/test_server_execution.py:64)
 - [test_extracts_first_mapping_line](tests/test_alias_definition.py:373)
@@ -3005,12 +3148,12 @@
 - [Test handling failed JSON response.](tests/test_response_handler.py:67)
 - [Convert failed result with error message.](tests/test_pipeline_debug.py:188)
 - [Test model_as_dict with objects that don&#x27;t have name/definition](tests/test_model_as_dict.py:189)
-- [PRs created by the new workflow touch boot source files; import remains legacy.](tests/test_github_pr_integration.py:314)
-- [Test fetching PR with invalid JSON content.](tests/test_github_pr_integration.py:539)
-- [Test fetching PR with invalid URL.](tests/test_github_pr_integration.py:344)
-- [Test fetching non-existent PR.](tests/test_github_pr_integration.py:484)
-- [Test successfully fetching PR export data.](tests/test_github_pr_integration.py:274)
-- [Test fetching PR that doesn&#x27;t modify the boot image file.](tests/test_github_pr_integration.py:509)
+- [PRs created by the new workflow touch boot source files; import remains legacy.](tests/test_github_pr_integration.py:331)
+- [Test fetching PR with invalid JSON content.](tests/test_github_pr_integration.py:556)
+- [Test fetching PR with invalid URL.](tests/test_github_pr_integration.py:361)
+- [Test fetching non-existent PR.](tests/test_github_pr_integration.py:501)
+- [Test successfully fetching PR export data.](tests/test_github_pr_integration.py:291)
+- [Test fetching PR that doesn&#x27;t modify the boot image file.](tests/test_github_pr_integration.py:526)
 - [test_fetch_variable_content_follows_relative_redirect](tests/test_server_execution_variables.py:51)
 - [test_fetch_variable_content_returns_none_without_app_context](tests/test_server_execution_variables.py:111)
 - [test_fetch_variable_content_returns_route_body](tests/test_server_execution_variables.py:44)
@@ -3026,6 +3169,7 @@
 - [Test finding missing CIDs when all are present.](tests/test_boot_cid_importer.py:99)
 - [Test finding missing CIDs when some are missing.](tests/test_boot_cid_importer.py:110)
 - [test_finds_function_in_definition](tests/test_server_execution.py:164)
+- [test_first_match_wins](tests/test_gateway_routing.py:93)
 - [Test that CSS url() references are fixed.](tests/test_hrx_response_transform.py:62)
 - [Test that external URLs in CSS are not modified.](tests/test_hrx_response_transform.py:73)
 - [Test that absolute paths in archive are fixed correctly.](tests/test_hrx_response_transform.py:15)
@@ -3037,6 +3181,9 @@
 - [Following the redirect should produce CID-backed HTML content.](tests/test_server_execution_redirect_result.py:49)
 - [test_form_sketch_preserves_literal_characters_in_code_block](tests/test_markdown_rendering.py:182)
 - [test_format_command_linkifies_pipeline_commands](tests/test_tldr_response_transform.py:21)
+- [Test formatting custom exception.](tests/test_gateway_diagnostic.py:28)
+- [Test formatting exception with message.](tests/test_gateway_diagnostic.py:16)
+- [Test formatting exception without message.](tests/test_gateway_diagnostic.py:22)
 - [Test formatting of error status codes.](tests/test_ai_eval_reports.py:253)
 - [Test formatting of a basic external API call.](tests/test_ai_eval_reports.py:172)
 - [Test that redacted API keys appear correctly in HTML.](tests/test_ai_eval_reports.py:201)
@@ -3045,6 +3192,8 @@
 - [test_format_helpers_accept_cid_object](tests/test_cid_presenter_render.py:73)
 - [test_format_history_timestamp_round_trips](tests/test_history_filters.py:14)
 - [test_format_screenshot_notice_builds_section](tests/test_build_report_site.py:81)
+- [Test formatting with debug context.](tests/test_gateway_diagnostic.py:211)
+- [Test formatting exception details.](tests/test_gateway_diagnostic.py:203)
 - [test_formats_error_message](tests/test_server_execution.py:754)
 - [test_formats_flask_match](tests/test_alias_definition.py:516)
 - [test_formats_glob_match](tests/test_alias_definition.py:508)
@@ -3065,14 +3214,16 @@
 - [Test generating CID from empty content.](tests/test_cid_class.py:89)
 - [Test generating CID from exactly 64 bytes (boundary case).](tests/test_cid_class.py:101)
 - [Test generating CID from large content.](tests/test_cid_class.py:116)
+- [Test building RequestDetails from parameters.](tests/test_gateway_models.py:78)
 - [Test conversion from PathSegmentInfo.](tests/test_io_execution.py:287)
 - [Test generating CID from small content.](tests/test_cid_class.py:95)
 - [test_frontend_filtering_orders_exact_partial_and_not_found](tests/test_routes_overview.py:96)
 - [Gateway should handle requests to non-existent gateways gracefully.](tests/test_gateway_server.py:93)
 - [Gateway should resolve internal redirects to CID content without corrupting raw bytes.](tests/test_gateway_server.py:113)
-- [Gateway should execute internal targets (like man) without HTTP requests.](tests/test_gateway_server.py:228)
-- [Gateway /request route should be accessible.](tests/test_gateway_server.py:191)
-- [Gateway /response route should be accessible.](tests/test_gateway_server.py:209)
+- [Gateway should execute internal targets (like man) without HTTP requests.](tests/test_gateway_server.py:229)
+- [Gateway /request route should be accessible.](tests/test_gateway_server.py:192)
+- [Gateway request routes handle server with and without path.](tests/test_gateway_routing.py:222)
+- [Gateway /response route should be accessible.](tests/test_gateway_server.py:210)
 - [Verify that the gateway server template is registered.](tests/test_gateway_server.py:49)
 - [Gateway should show instruction page with configured gateways.](tests/test_gateway_server.py:61)
 - [Gateway template should have proper id, name, and description.](tests/test_gateway_server.py:78)
@@ -3416,6 +3567,10 @@
 - [test_google_service_account_rejects_empty_subject](tests/test_external_api_google_microsoft_auth.py:94)
 - [test_google_service_account_subject_adds_sub_claim](tests/test_external_api_google_microsoft_auth.py:73)
 - [test_google_service_account_success](tests/test_external_api_google_microsoft_auth.py:41)
+- [test_greedy_path_variable](tests/test_gateway_routing.py:53)
+- [test_greedy_path_variable_empty](tests/test_gateway_routing.py:63)
+- [test_greedy_path_variable_single_segment](tests/test_gateway_routing.py:58)
+- [test_greedy_with_trailing_segments](tests/test_gateway_routing.py:73)
 - [Grep should match pattern from $1.](tests/test_bash_path_parameters.py:325)
 - [Bytearray content should be handled correctly.](tests/test_external_api_content_decoder.py:85)
 - [References should be detected even with multiple levels of aliasing.](tests/test_extract_context_references.py:79)
@@ -3435,6 +3590,7 @@
 - [test_handles_empty_variables](tests/test_alias_definition.py:488)
 - [Encoding values with leading/trailing whitespace should be normalized.](tests/test_external_api_content_decoder.py:72)
 - [test_handles_external_target_error](tests/test_alias_definition.py:608)
+- [Test that lowercase header names are also removed.](tests/test_gateway_diagnostic.py:171)
 - [Test validation with many small modules.](tests/test_validate_import_export_integration.py:424)
 - [Encoding names should be case-insensitive.](tests/test_external_api_content_decoder.py:111)
 - [test_handles_mock_object](tests/test_alias_definition.py:577)
@@ -3582,8 +3738,8 @@
 - [Verify that interaction history includes timestamp_url for URL generation.](tests/test_entity_interactions.py:85)
 - [Test that saved JSON includes external_calls field.](tests/test_ai_eval_reports.py:271)
 - [Test that interaction data is JSON serializable.](tests/test_ai_eval_reports.py:314)
-- [test_internal_jsonplaceholder_decompresses_gzip](tests/test_gateway_server.py:163)
-- [Internal jsonplaceholder server should force identity encoding to avoid compressed bytes.](tests/test_gateway_server.py:135)
+- [test_internal_jsonplaceholder_decompresses_gzip](tests/test_gateway_server.py:164)
+- [Internal jsonplaceholder server should force identity encoding to avoid compressed bytes.](tests/test_gateway_server.py:136)
 - [test_invalid_api_key_format_returns_error](tests/test_external_server_mailchimp.py:15)
 - [Test CID with JSON array instead of object.](tests/test_cli.py:192)
 - [Test CID with no content.](tests/test_cli.py:214)
@@ -3997,8 +4153,8 @@
 - [Test making GET request to valid path.](tests/test_cli.py:342)
 - [Test making GET request with query parameters.](tests/test_cli.py:370)
 - [test_make_session_permanent_marks_session](tests/test_analytics.py:42)
-- [Man transform should raise error if resolve_template not available.](tests/test_gateway_server.py:692)
-- [Man response transform should use external template via resolve_template.](tests/test_gateway_server.py:631)
+- [Man transform should raise error if resolve_template not available.](tests/test_gateway_server.py:693)
+- [Man response transform should use external template via resolve_template.](tests/test_gateway_server.py:632)
 - [test_markdown_executes_via_server_execution](tests/test_markdown.py:99)
 - [test_markdown_heuristic_balances_inline_and_structural_cues](tests/test_cid_functionality.py:570)
 - [test_markdown_heuristic_ignores_plain_python_text](tests/test_cid_functionality.py:574)
@@ -4049,11 +4205,15 @@
 - [Test that /meta returns server info when CID is a server definition.](tests/test_meta_route.py:490)
 - [Test that /meta returns enhanced server metadata for urleditor.](tests/test_meta_route.py:470)
 - [Test that /meta/{CID} works for CID literal requests.](tests/test_meta_route.py:512)
+- [Meta test pattern checked before general meta.](tests/test_gateway_routing.py:182)
 - [test_microsoft_client_credentials_success](tests/test_external_api_google_microsoft_auth.py:247)
 - [test_microsoft_error_response](tests/test_external_api_google_microsoft_auth.py:264)
 - [test_microsoft_missing_scopes_returns_validation_error](tests/test_external_api_google_microsoft_auth.py:272)
 - [test_microsoft_missing_secret](tests/test_external_api_google_microsoft_auth.py:256)
 - [test_microsoft_request_exception_returns_structured_error](tests/test_external_api_google_microsoft_auth.py:281)
+- [Middleware can see modifications made by previous middleware.](tests/test_gateway_middleware.py:210)
+- [Multiple middleware can transform context.](tests/test_gateway_middleware.py:153)
+- [Multiple middleware can transform result.](tests/test_gateway_middleware.py:175)
 - [Test reverse MIME type lookup.](tests/test_mime_utils.py:26)
 - [Test MIME types with parameters (e.g., charset).](tests/test_mime_utils.py:77)
 - [test_missing_access_token_returns_auth_error](tests/test_external_server_basecamp.py:39)
@@ -4173,6 +4333,8 @@
 - [test_missing_url_returns_auth_error](tests/test_external_server_activecampaign.py:19)
 - [Test mixing authorized and rejected requests.](tests/test_authorization_integration.py:140)
 - [Test that constructor normalizes operations.](tests/test_operation_validator.py:140)
+- [test_mixed_literal_and_greedy_path](tests/test_gateway_routing.py:68)
+- [test_mixed_literal_and_variable](tests/test_gateway_routing.py:48)
 - [Test model_as_dict with mixed object types](tests/test_model_as_dict.py:164)
 - [test_model_as_dict_ignores_disabled_entries](tests/test_variables_secrets_issue.py:154)
 - [test_model_to_dict_includes_extra_fields](tests/test_serialization.py:31)
@@ -4199,15 +4361,19 @@
 - [/io/s1///s2 ignores all empty segments.](tests/test_io_execution.py:100)
 - [Test multiple entities with mixed enabled states.](tests/test_enabled_field_persistence.py:190)
 - [Test function with multiple lines of code.](tests/test_text_function_runner.py:22)
+- [Middleware executes in reverse order for after_request.](tests/test_gateway_middleware.py:134)
+- [Middleware executes in added order for before_request.](tests/test_gateway_middleware.py:119)
 - [Test that first missing parameter is reported.](tests/test_parameter_validator.py:273)
 - [Test that only first missing secret is reported.](tests/test_credential_validator.py:184)
 - [Test model_as_dict with multiple objects](tests/test_model_as_dict.py:121)
 - [test_multiple_relative_links_convert_independently](tests/test_markdown_rendering.py:306)
 - [Test validating multiple required credentials.](tests/test_credential_validator.py:213)
+- [test_multiple_routes_in_order](tests/test_gateway_routing.py:125)
 - [/io/s1/param/s2 returns [&#x27;s1&#x27;, &#x27;param&#x27;, &#x27;s2&#x27;].](tests/test_io_execution.py:90)
 - [Multiple segments are all analyzed.](tests/test_pipeline_execution.py:534)
 - [Multiple servers each get their own params.](tests/test_io_execution.py:177)
 - [Test that multiple successful requests work.](tests/test_authorization_integration.py:133)
+- [test_multiple_variable_capture](tests/test_gateway_routing.py:43)
 - [test_mysql_url](tests/test_external_server_sqlalchemy_pool.py:98)
 - [test_named_clojure_server_executes_terminal_python_literal](tests/test_clojure_server_execution.py:243)
 - [test_named_clojure_server_receives_python_input](tests/test_clojure_server_execution.py:227)
@@ -4260,13 +4426,19 @@
 - [Test params with None values.](tests/test_preview_builder.py:309)
 - [Nonexistent server returns None.](tests/test_pipeline_execution.py:431)
 - [Test normalizing empty string.](tests/test_cid_core.py:56)
+- [Test that empty string returns None.](tests/test_gateway_normalizer.py:13)
 - [test_normalize_man_terminal_formatting_collapses_backspace_overstrikes](tests/test_man_response_transform.py:10)
 - [test_normalize_man_terminal_formatting_handles_cursor_backspace](tests/test_man_response_transform.py:18)
 - [Test normalizing None.](tests/test_cid_core.py:52)
+- [Test that None input returns None.](tests/test_gateway_normalizer.py:9)
 - [Test operation normalization.](tests/test_operation_validator.py:43)
+- [Test normalization of path without leading slash.](tests/test_gateway_normalizer.py:32)
+- [Test that leading slash is preserved.](tests/test_gateway_normalizer.py:27)
+- [Test that whitespace is stripped.](tests/test_gateway_normalizer.py:22)
 - [test_normalize_tldr_terminal_output_handles_backspaces](tests/test_tldr_response_transform.py:16)
 - [test_normalize_tldr_terminal_output_strips_ansi_sequences](tests/test_tldr_response_transform.py:11)
 - [test_normalize_variable_path_handles_valid_and_invalid_inputs](tests/test_server_execution_variables.py:23)
+- [Test that whitespace-only string returns None.](tests/test_gateway_normalizer.py:17)
 - [Test normalizing string with internal slash returns empty.](tests/test_cid_core.py:69)
 - [Test normalizing string with leading slash.](tests/test_cid_core.py:61)
 - [Test normalizing string with whitespace.](tests/test_cid_core.py:65)
@@ -4279,6 +4451,8 @@
 - [Nullable fields behave equivalently.](tests/test_db_edge_cases_equivalence.py:91)
 - [Test OAuth token or API key pattern.](tests/test_credential_validator.py:139)
 - [Test checking OK response.](tests/test_response_handler.py:140)
+- [test_on_error_default_does_nothing](tests/test_gateway_middleware.py:25)
+- [All middleware on_error handlers are called.](tests/test_gateway_middleware.py:196)
 - [Test opening browser with exception.](tests/test_cli.py:408)
 - [Test opening browser successfully.](tests/test_cli.py:399)
 - [test_openapi_schema_describes_interactions_endpoint](tests/test_openapi.py:25)
@@ -4322,21 +4496,28 @@
 - [test_parse_import_payload_success](tests/test_import_export_helpers.py:14)
 - [Test parsing CID with invalid base64 raises error.](tests/test_cid_core.py:203)
 - [Test parsing too short CID raises error.](tests/test_cid_core.py:198)
-- [Test parsing URL with invalid hostname.](tests/test_github_pr_integration.py:47)
-- [Test parsing URL with invalid path.](tests/test_github_pr_integration.py:56)
-- [Test parsing URL with non-numeric PR number.](tests/test_github_pr_integration.py:74)
+- [Test parsing URL with invalid hostname.](tests/test_github_pr_integration.py:64)
+- [Test parsing URL with invalid path.](tests/test_github_pr_integration.py:73)
+- [Test parsing URL with non-numeric PR number.](tests/test_github_pr_integration.py:91)
 - [Should parse kilobyte values.](tests/test_cli_args_readonly.py:22)
-- [Test parsing malformed URL.](tests/test_github_pr_integration.py:83)
+- [Test parsing malformed URL.](tests/test_github_pr_integration.py:100)
 - [Should parse megabyte values.](tests/test_cli_args_readonly.py:28)
 - [Test parsing meta page with test pattern.](tests/test_gateway_test_support.py:76)
-- [Test parsing URL missing PR number.](tests/test_github_pr_integration.py:65)
+- [Test parsing URL missing PR number.](tests/test_github_pr_integration.py:82)
 - [Test parsing a simple HRX archive with two files.](tests/test_hrx_parser.py:11)
 - [Should parse terabyte values.](tests/test_cli_args_readonly.py:40)
 - [Test parsing when there&#x27;s no rest path after server name.](tests/test_gateway_test_support.py:58)
 - [Test parsing a simple test server path.](tests/test_gateway_test_support.py:14)
 - [Test parsing test server path with nested structure.](tests/test_gateway_test_support.py:40)
-- [Test parsing a valid GitHub PR URL.](tests/test_github_pr_integration.py:29)
-- [Test parsing a valid GitHub PR URL with www.](tests/test_github_pr_integration.py:38)
+- [Test parsing a valid GitHub PR URL.](tests/test_github_pr_integration.py:46)
+- [Test parsing a valid GitHub PR URL with www.](tests/test_github_pr_integration.py:55)
+- [Test parsing path with archive and file path.](tests/test_gateway_normalizer.py:41)
+- [Test parsing path with archive only.](tests/test_gateway_normalizer.py:47)
+- [Test parsing empty string.](tests/test_gateway_normalizer.py:53)
+- [Test parsing path with leading slash.](tests/test_gateway_normalizer.py:65)
+- [Test parsing path with multiple slashes.](tests/test_gateway_normalizer.py:77)
+- [Test parsing None.](tests/test_gateway_normalizer.py:59)
+- [Test parsing path with trailing slash (strips trailing slashes).](tests/test_gateway_normalizer.py:71)
 - [test_parses_context_strings_as_json](tests/test_ai_editor.py:111)
 - [test_parses_keyword_only_params](tests/test_server_execution.py:122)
 - [test_parses_simple_function](tests/test_server_execution.py:109)
@@ -4374,7 +4555,7 @@
 - [Test that regex pattern is preserved during import.](tests/test_alias_import_definition_preservation.py:47)
 - [Test that root pattern / is preserved during import.](tests/test_alias_import_definition_preservation.py:81)
 - [test_prepare_alias_import_uses_definition_cid](tests/test_import_export.py:1388)
-- [test_prepare_boot_image_update_materializes_cids_and_does_not_write_generated_outputs](tests/test_github_pr_integration.py:356)
+- [test_prepare_boot_image_update_materializes_cids_and_does_not_write_generated_outputs](tests/test_github_pr_integration.py:373)
 - [test_prepare_history_event_reports_invalid_timestamp](tests/test_import_export_helpers.py:123)
 - [test_prepare_history_event_truncates_long_messages](tests/test_import_export_helpers.py:105)
 - [test_prepare_server_import_falls_back_to_cid](tests/test_import_export_helpers.py:51)
@@ -4384,6 +4565,7 @@
 - [test_preserves_inline_comment](tests/test_alias_definition.py:390)
 - [test_preserves_line_without_comment](tests/test_alias_definition.py:357)
 - [Test that non-sensitive headers are preserved.](tests/test_preview_builder.py:185)
+- [Test that other fields are preserved.](tests/test_gateway_diagnostic.py:185)
 - [test_preserves_pattern_text](tests/test_alias_definition.py:684)
 - [test_preserves_unknown_variables](tests/test_alias_definition.py:472)
 - [Test that sensitive headers are redacted.](tests/test_preview_builder.py:66)
@@ -4520,6 +4702,8 @@
 - [test_relative_link_with_custom_label_uses_pipe_syntax](tests/test_markdown_rendering.py:279)
 - [test_relative_link_with_explicit_trailing_slash_is_preserved](tests/test_markdown_rendering.py:319)
 - [test_relative_link_with_lowercase_name_preserves_label](tests/test_markdown_rendering.py:314)
+- [Test that authorization headers are removed.](tests/test_gateway_diagnostic.py:143)
+- [Test that cookie headers are removed.](tests/test_gateway_diagnostic.py:157)
 - [Even when relative resolution fails, redundant project roots should be stripped.](tests/test_error_page_path_formatting.py:112)
 - [test_render_alias_link_full_url](tests/test_link_presenter.py:46)
 - [test_render_alias_link_relative_path](tests/test_link_presenter.py:40)
@@ -4625,10 +4809,10 @@
 - [test_request_exceptions_include_status](tests/test_external_server_google_sheets.py:163)
 - [test_request_logs_and_raises_request_exception](tests/test_external_api_http_client.py:69)
 - [Test that auth parameter is correctly passed to session.request().](tests/test_external_api_http_client.py:82)
-- [Request transform returning response dict should bypass server execution.](tests/test_gateway_server.py:317)
-- [Direct response from request transform should preserve content_type.](tests/test_gateway_server.py:359)
-- [Request transform returning normal dict should continue to server.](tests/test_gateway_server.py:389)
-- [If both &#x27;response&#x27; and &#x27;path&#x27; keys present, &#x27;response&#x27; takes precedence.](tests/test_gateway_server.py:432)
+- [Request transform returning response dict should bypass server execution.](tests/test_gateway_server.py:318)
+- [Direct response from request transform should preserve content_type.](tests/test_gateway_server.py:360)
+- [Request transform returning normal dict should continue to server.](tests/test_gateway_server.py:390)
+- [If both &#x27;response&#x27; and &#x27;path&#x27; keys present, &#x27;response&#x27; takes precedence.](tests/test_gateway_server.py:433)
 - [test_request_uses_defaults_and_logs](tests/test_external_api_http_client.py:34)
 - [test_request_uses_provided_timeout](tests/test_external_api_http_client.py:58)
 - [test_require_invitation_removed](tests/test_routes_comprehensive.py:1141)
@@ -4698,24 +4882,42 @@
 - [test_requires_user_or_device_id](tests/test_external_server_amplitude.py:12)
 - [test_requires_warehouse](tests/test_external_server_snowflake.py:24)
 - [test_requires_write_key](tests/test_external_server_segment.py:6)
+- [Servers named &#x27;meta&#x27;, &#x27;request&#x27;, &#x27;response&#x27;, or &#x27;test&#x27; are shadowed.](tests/test_gateway_routing.py:157)
 - [Reset should restore defaults.](tests/test_readonly_config.py:39)
 - [Reset should return to disk mode.](tests/test_db_config.py:59)
+- [Test that resolver adds leading slash for database lookup.](tests/test_gateway_cid_resolver.py:64)
 - [Chained input resolution honors the pipeline compatibility layer.](tests/test_pipeline_feature_flag.py:33)
 - [Test resolve_cid_value with actual CID.](tests/test_template_manager.py:357)
 - [Test resolve_cid_value with direct value.](tests/test_template_manager.py:350)
 - [Test resolve_cid_value with empty value.](tests/test_template_manager.py:373)
 - [Test resolve_cid_value with leading slash.](tests/test_template_manager.py:379)
+- [Test converting bytes data to string when as_bytes=False.](tests/test_gateway_cid_resolver.py:150)
+- [Test converting string data to bytes when as_bytes=True.](tests/test_gateway_cid_resolver.py:138)
+- [Test resolving content that is directly bytes (no file_data or data attribute).](tests/test_gateway_cid_resolver.py:181)
+- [Test resolving content that is directly a string.](tests/test_gateway_cid_resolver.py:190)
 - [test_resolve_format_defaults_to_html_when_header_missing](tests/test_response_formats.py:36)
 - [test_resolve_format_falls_back_to_wildcard_application](tests/test_response_formats.py:31)
 - [test_resolve_format_handles_xml_only_accept_header](tests/test_response_formats.py:26)
 - [test_resolve_format_prefers_highest_quality_html](tests/test_response_formats.py:16)
 - [test_resolve_format_prefers_json_when_higher_quality](tests/test_response_formats.py:21)
+- [Test resolving CID from database as bytes.](tests/test_gateway_cid_resolver.py:52)
+- [Test resolving CID from database with data attribute.](tests/test_gateway_cid_resolver.py:40)
+- [Test resolving CID from database with file_data attribute.](tests/test_gateway_cid_resolver.py:28)
+- [Test resolving from filesystem as bytes.](tests/test_gateway_cid_resolver.py:109)
+- [Test resolving from filesystem path.](tests/test_gateway_cid_resolver.py:95)
+- [Test that resolver handles database exceptions gracefully.](tests/test_gateway_cid_resolver.py:86)
+- [Test that resolver handles None CID value gracefully.](tests/test_gateway_cid_resolver.py:209)
 - [test_resolve_many_and_available_sources](tests/test_server_execution.py:433)
 - [test_resolve_named_value_returns_none_when_missing](tests/test_server_execution.py:462)
 - [test_resolve_named_values_honours_priority](tests/test_server_execution.py:469)
+- [Test that resolver doesn&#x27;t cache results.](tests/test_gateway_cid_resolver.py:161)
+- [Test that resolver preserves existing leading slash.](tests/test_gateway_cid_resolver.py:75)
 - [test_resolve_redirect_target](tests/test_server_execution_variables.py:40)
+- [Test that resolve returns None for CID that doesn&#x27;t exist anywhere.](tests/test_gateway_cid_resolver.py:22)
+- [Test that leading slash is stripped for filesystem lookup.](tests/test_gateway_cid_resolver.py:123)
 - [Test that test target resolution adds leading slash if missing.](tests/test_gateway_test_support.py:98)
 - [Test that test target resolution keeps existing leading slash.](tests/test_gateway_test_support.py:111)
+- [Test resolving Unicode content.](tests/test_gateway_cid_resolver.py:199)
 - [test_resolve_variable_values_keeps_original_when_fetch_fails](tests/test_server_execution_variables.py:79)
 - [test_resolve_variable_values_prefetches_when_possible](tests/test_server_execution_variables.py:58)
 - [test_resolve_variable_values_returns_copy_when_prefetch_skipped](tests/test_server_execution_variables.py:96)
@@ -4724,8 +4926,9 @@
 - [test_resolves_from_context_variables](tests/test_server_execution.py:359)
 - [test_resolves_from_query_string](tests/test_server_execution.py:331)
 - [test_resolves_variables_from_alias_attributes](tests/test_alias_definition.py:623)
-- [Response details from request transform should have source=&#x27;request_transform&#x27;.](tests/test_gateway_server.py:515)
-- [Response details from server should have source=&#x27;server&#x27;.](tests/test_gateway_server.py:475)
+- [Response details from request transform should have source=&#x27;request_transform&#x27;.](tests/test_gateway_server.py:516)
+- [Response details from server should have source=&#x27;server&#x27;.](tests/test_gateway_server.py:476)
+- [Test response with JSON data.](tests/test_gateway_models.py:110)
 - [Test response with null values.](tests/test_response_handler.py:274)
 - [Test response without ok attribute.](tests/test_response_handler.py:154)
 - [Convert result with segments.](tests/test_pipeline_debug.py:162)
@@ -4762,6 +4965,9 @@
 - [Root path is not a pipeline.](tests/test_pipeline_recognition.py:238)
 - [Root path only returns error.](tests/test_pipeline_execution.py:492)
 - [Test that generated CID can be checked back.](tests/test_cid_editor_helper.py:123)
+- [test_route_no_match_raises_error](tests/test_gateway_routing.py:118)
+- [test_route_strips_leading_trailing_slashes](tests/test_gateway_routing.py:111)
+- [test_route_with_captured_params](tests/test_gateway_routing.py:101)
 - [The API should respond with JSON describing available routes.](tests/test_routes_overview_api.py:6)
 - [test_run_actor_validation](tests/test_external_server_apify.py:23)
 - [test_run_bash_script_times_out](tests/test_server_execution.py:760)
@@ -4794,6 +5000,7 @@
 - [Secrets index returns HTTP 200 when accessed by a logged-in user.](tests/test_routes_comprehensive.py:2249)
 - [Sed should process expression from $1.](tests/test_bash_path_parameters.py:303)
 - [segment_analysis module should exist.](tests/test_io_server_integration.py:108)
+- [test_segment_count_mismatch](tests/test_gateway_routing.py:78)
 - [Handle segment ending with dot.](tests/test_pipeline_recognition.py:194)
 - [Convert segment with alias chain.](tests/test_pipeline_debug.py:116)
 - [Convert segment with errors.](tests/test_pipeline_debug.py:102)
@@ -4899,6 +5106,9 @@
 - [Test signing with a session token.](tests/test_aws_signature.py:90)
 - [Parse simple path into segments.](tests/test_pipeline_recognition.py:18)
 - [Single alias resolution tracked.](tests/test_pipeline_execution.py:263)
+- [test_single_middleware_after_request](tests/test_gateway_middleware.py:97)
+- [test_single_middleware_before_request](tests/test_gateway_middleware.py:86)
+- [test_single_middleware_on_error](tests/test_gateway_middleware.py:108)
 - [Test model_as_dict with single objects](tests/test_model_as_dict.py:88)
 - [Test validator with single operation.](tests/test_operation_validator.py:64)
 - [Test that /server/param passes param to server. In /echo/hello: - &#x27;echo&#x27; is the server - &#x27;hello&#x27; is a parameter that should be passed to echo](tests/test_pipeline_parameter_binding.py:100)
@@ -4909,6 +5119,7 @@
 - [Single path segment is not a pipeline.](tests/test_pipeline_recognition.py:205)
 - [Single server returns one group with no params.](tests/test_io_execution.py:147)
 - [Single server is marked as tail.](tests/test_io_execution.py:253)
+- [test_single_variable_capture](tests/test_gateway_routing.py:38)
 - [test_site_url_parameter_overrides_secret](tests/test_external_server_wordpress.py:185)
 - [Test that hidden files (starting with .) are skipped.](tests/test_cid_directory_loader.py:99)
 - [test_skips_blank_lines](tests/test_alias_definition.py:377)
@@ -5077,10 +5288,11 @@
 - [test_template_does_not_depend_on_server_name](tests/test_pygments_server_template.py:69)
 - [Test that template objects have None as ID since they&#x27;re not in DB.](tests/test_db_access_templates.py:144)
 - [Test that all template objects are marked with template=True.](tests/test_db_access_templates.py:156)
-- [Template resolver should be created from gateway config.](tests/test_gateway_server.py:566)
-- [resolve_template should raise LookupError if CID cannot be resolved.](tests/test_gateway_server.py:598)
-- [resolve_template should raise ValueError for unknown template name.](tests/test_gateway_server.py:580)
+- [Template resolver should be created from gateway config.](tests/test_gateway_server.py:567)
+- [resolve_template should raise LookupError if CID cannot be resolved.](tests/test_gateway_server.py:599)
+- [resolve_template should raise ValueError for unknown template name.](tests/test_gateway_server.py:581)
 - [test_tenant_id_parameter_overrides_secret](tests/test_external_server_xero.py:160)
+- [Test routes handle both with and without rest path.](tests/test_gateway_routing.py:202)
 - [Plain text response has correct content type.](tests/test_pipeline_debug.py:376)
 - [Test plain text error response for 401.](tests/test_authorization_handler.py:49)
 - [Test plain text error response for 403.](tests/test_authorization_handler.py:64)
@@ -5127,6 +5339,8 @@
 - [Test that error pages use external templates.](tests/test_hrx_response_transform.py:109)
 - [Test that markdown files use external templates.](tests/test_hrx_response_transform.py:202)
 - [Test that text files use external templates.](tests/test_hrx_response_transform.py:224)
+- [Test transform result with bytes output.](tests/test_gateway_models.py:146)
+- [Test transform result with custom headers.](tests/test_gateway_models.py:155)
 - [test_truthiness_for_response_status](tests/test_conditional_execution.py:58)
 - [test_truthiness_for_strings](tests/test_conditional_execution.py:54)
 - [test_try_alias_redirect_checks_subsequent_declarations](tests/test_alias_routing.py:249)
@@ -5293,14 +5507,17 @@
 - [Unsupported auto main signatures should include helpful reasons.](tests/test_server_definition_validation_route.py:78)
 - [Syntax errors should be surfaced to the caller.](tests/test_server_definition_validation_route.py:63)
 - [Valid auto main definitions should report parameter metadata.](tests/test_server_definition_validation_route.py:32)
-- [Test _validate_direct_response accepts bytes output.](tests/test_gateway_server.py:304)
-- [Test _validate_direct_response with invalid output type.](tests/test_gateway_server.py:276)
-- [Test _validate_direct_response with invalid status_code type.](tests/test_gateway_server.py:290)
-- [Test _validate_direct_response with missing output key.](tests/test_gateway_server.py:264)
-- [Test _validate_direct_response with valid direct response.](tests/test_gateway_server.py:250)
+- [Test _validate_direct_response accepts bytes output.](tests/test_gateway_server.py:305)
+- [Test _validate_direct_response with invalid output type.](tests/test_gateway_server.py:277)
+- [Test _validate_direct_response with invalid status_code type.](tests/test_gateway_server.py:291)
+- [Test _validate_direct_response with missing output key.](tests/test_gateway_server.py:265)
+- [Test _validate_direct_response with valid direct response.](tests/test_gateway_server.py:251)
 - [test_validate_email_requires_email](tests/test_external_server_mailgun.py:28)
+- [Test validating internal target.](tests/test_gateway_models.py:176)
 - [Test that large modules are properly detected.](tests/test_validate_import_export_integration.py:229)
 - [Test validating a properly refactored module structure.](tests/test_validate_import_export_integration.py:137)
+- [Test validation rejects external mode.](tests/test_gateway_models.py:181)
+- [Test validation rejects external URL.](tests/test_gateway_models.py:187)
 - [Test validation when all required parameters are present.](tests/test_parameter_validator.py:11)
 - [Test that empty string is treated as missing.](tests/test_parameter_validator.py:36)
 - [Test operation with no required parameters.](tests/test_parameter_validator.py:60)
@@ -5334,6 +5551,7 @@
 - [Test that Variable defaults to enabled=True when not specified.](tests/test_enabled_field_persistence.py:142)
 - [Test that Variable with enabled=False is stored and retrieved correctly.](tests/test_enabled_field_persistence.py:114)
 - [Test that Variable with enabled=True is stored and retrieved correctly.](tests/test_enabled_field_persistence.py:128)
+- [Test that {var:path} extracts &#x27;var&#x27; as the parameter name.](tests/test_gateway_routing.py:83)
 - [Unique constraint behavior is equivalent in both databases.](tests/test_db_equivalence.py:178)
 - [Variable detail view should render CID link when definition is a CID.](tests/test_routes_comprehensive.py:2157)
 - [Variable detail view should render matching route information.](tests/test_routes_comprehensive.py:2137)
@@ -5683,8 +5901,8 @@
 - [Test that gateway correctly parses CID and path.](tests/integration/test_gateway_cids.py:77)
 - [Test that gateway with invalid CID shows error.](tests/integration/test_gateway_cids.py:71)
 - [Test that gateway without archive CID shows error.](tests/integration/test_gateway_cids.py:65)
-- [All Server/Meta/Test link targets in the Configured Gateways table should work locally. This uses Flask&#x27;s test client (one-shot) and does not involve a browser or outbound HTTP requests.](tests/integration/test_gateway_server.py:282)
-- [Error page should include diagnostic information when available.](tests/integration/test_gateway_server.py:501)
+- [All Server/Meta/Test link targets in the Configured Gateways table should work locally. This uses Flask&#x27;s test client (one-shot) and does not involve a browser or outbound HTTP requests.](tests/integration/test_gateway_server.py:290)
+- [Error page should include diagnostic information when available.](tests/integration/test_gateway_server.py:526)
 - [test_gateway_hrx_error_page_shows_archive_and_path](tests/integration/test_gateway_hrx.py:730)
 - [Test that /gateway/hrx returns error for non-existent file.](tests/integration/test_gateway_hrx.py:197)
 - [Test that /gateway/hrx returns HTML files with proper content type.](tests/integration/test_gateway_hrx.py:284)
@@ -5699,26 +5917,26 @@
 - [Test that /gateway/hrx/{cid}/{path} returns file content from HRX archive.](tests/integration/test_gateway_hrx.py:105)
 - [Test that /gateway/hrx returns JSON file content correctly.](tests/integration/test_gateway_hrx.py:139)
 - [Gateway instruction page should include the link table headers.](tests/integration/test_gateway_server.py:128)
-- [Gateway instruction page should include archived external-service servers.](tests/integration/test_gateway_server.py:204)
+- [Gateway instruction page should include archived external-service servers.](tests/integration/test_gateway_server.py:212)
 - [Gateway instruction page should include links for gateways loaded from gateways.source.json.](tests/integration/test_gateway_server.py:145)
 - [Test that /gateway shows instruction page with configured gateways.](tests/integration/test_gateway_hrx.py:686)
 - [test_gateway_instruction_page_sample_links_use_service_specific_cids](tests/integration/test_gateway_table_links.py:304)
 - [test_gateway_instruction_page_test_links_return_html_with_links](tests/integration/test_gateway_table_links.py:263)
 - [Test that /gateway/man/ls routes to /servers/man/ls.](tests/integration/test_gateway_hrx.py:669)
 - [Test that /gateway/man/grep returns the man page without HTTP proxying.](tests/integration/test_gateway_hrx.py:558)
-- [Gateway meta page should show error for unknown gateway.](tests/integration/test_gateway_server.py:487)
-- [Gateway meta page should validate transforms stored as DB CIDs even without a leading slash.](tests/integration/test_gateway_server.py:384)
-- [Meta page should list templates referenced by resolve_template calls, even if not configured.](tests/integration/test_gateway_server.py:400)
-- [Gateway meta page should show gateway configuration.](tests/integration/test_gateway_server.py:370)
-- [Meta page should show message when no templates configured.](tests/integration/test_gateway_server.py:604)
-- [Meta page should show detected template variables.](tests/integration/test_gateway_server.py:561)
-- [Meta page should show templates section when templates are configured.](tests/integration/test_gateway_server.py:517)
-- [Gateway request form should be accessible.](tests/integration/test_gateway_server.py:254)
-- [Gateway response form should be accessible.](tests/integration/test_gateway_server.py:268)
-- [Gateway should return an error page when a configured response transform cannot be loaded.](tests/integration/test_gateway_server.py:454)
+- [Gateway meta page should show error for unknown gateway.](tests/integration/test_gateway_server.py:512)
+- [Gateway meta page should validate transforms stored as DB CIDs even without a leading slash.](tests/integration/test_gateway_server.py:409)
+- [Meta page should list templates referenced by resolve_template calls, even if not configured.](tests/integration/test_gateway_server.py:425)
+- [Gateway meta page should show gateway configuration.](tests/integration/test_gateway_server.py:395)
+- [Meta page should show message when no templates configured.](tests/integration/test_gateway_server.py:629)
+- [Meta page should show detected template variables.](tests/integration/test_gateway_server.py:586)
+- [Meta page should show templates section when templates are configured.](tests/integration/test_gateway_server.py:542)
+- [Gateway request form should be accessible.](tests/integration/test_gateway_server.py:262)
+- [Gateway response form should be accessible.](tests/integration/test_gateway_server.py:276)
+- [Gateway should return an error page when a configured response transform cannot be loaded.](tests/integration/test_gateway_server.py:479)
 - [Gateway server should show instruction page with configured gateways.](tests/integration/test_gateway_server.py:112)
-- [Gateway should gracefully handle missing gateways variable.](tests/integration/test_gateway_server.py:239)
-- [Meta page should show error for invalid template.](tests/integration/test_gateway_server.py:638)
+- [Gateway should gracefully handle missing gateways variable.](tests/integration/test_gateway_server.py:247)
+- [Meta page should show error for invalid template.](tests/integration/test_gateway_server.py:663)
 - [Test that gateway test meta page shows test information.](tests/integration/test_gateway_test_server.py:120)
 - [Regression: HRX test server should not execute the archive CID as python.](tests/integration/test_gateway_test_server.py:257)
 - [Test that test pattern uses the transforms from the named gateway.](tests/integration/test_gateway_test_server.py:237)
@@ -5729,7 +5947,7 @@
 - [Test that /gateway/tldr/grep includes the stdin pipeline example and linkifies commands.](tests/integration/test_gateway_hrx.py:622)
 - [Test that /gateway/tldr/ls returns an HTML page without HTTP proxying.](tests/integration/test_gateway_hrx.py:607)
 - [Test that unknown gateway names return Gateway Not Found error.](tests/integration/test_gateway_hrx.py:703)
-- [/gateways should return the gateway home page content.](tests/integration/test_gateway_server.py:192)
+- [/gateways should return the gateway home page content.](tests/integration/test_gateway_server.py:200)
 - [Grep server should accept pattern from path segment.](tests/integration/test_bash_path_parameters.py:233)
 - [Grep server output should chain to the server on its left.](tests/integration/test_bash_path_parameters.py:284)
 - [Grep server should accept CID as input source.](tests/integration/test_bash_path_parameters.py:261)
@@ -5969,21 +6187,91 @@
 
 ## Property Tests
 
-Total: 14 tests
+Total: 84 tests
 
 - [TestPropertyBasedEquivalence.test_cid_binary_storage_equivalence](tests/property/test_db_equivalence_property.py:46)
 - [TestPropertyBasedEquivalence.test_server_roundtrip_equivalence](tests/property/test_db_equivalence_property.py:21)
+- [Creating an AuthorizationResult with allowed=True should not require status or message.](tests/property/test_authorization_properties.py:37)
+- [When allowed=True, status_code and message should default to None.](tests/property/test_authorization_properties.py:129)
+- [Creating an AuthorizationResult with invalid status code should raise ValueError.](tests/property/test_authorization_properties.py:97)
+- [Rejection messages should not be empty strings.](tests/property/test_authorization_properties.py:154)
+- [Only 401 and 403 should be accepted as valid rejection status codes.](tests/property/test_authorization_properties.py:141)
+- [AuthorizationResult should preserve all properties correctly.](tests/property/test_authorization_properties.py:112)
+- [Creating a rejected AuthorizationResult with valid status and message should succeed.](tests/property/test_authorization_properties.py:54)
+- [Creating a rejected AuthorizationResult without message should raise ValueError.](tests/property/test_authorization_properties.py:83)
+- [Creating a rejected AuthorizationResult without status_code should raise ValueError.](tests/property/test_authorization_properties.py:70)
+- [Base64url decode should handle strings without padding.](tests/property/test_cid_core_properties.py:188)
+- [Encoding bytes and decoding back should yield original data.](tests/property/test_cid_core_properties.py:55)
+- [Base64url encoding should not include padding characters.](tests/property/test_cid_core_properties.py:66)
 - [test_cid_binary_storage_equivalence](tests/property/test_db_equivalence_property.py:46)
+- [Encoding and decoding CID length should round-trip correctly.](tests/property/test_cid_core_properties.py:165)
+- [Encoded CID length should always be exactly CID_LENGTH_PREFIX_CHARS.](tests/property/test_cid_core_properties.py:151)
 - [When an extension is provided, the MIME type matches the extension.](tests/property/test_serve_cid_content_properties.py:34)
 - [A /CID request returns exactly the stored content.](tests/property/test_serve_cid_content_properties.py:16)
+- [Extracted filenames should not contain directory traversal patterns.](tests/property/test_mime_utils_properties.py:220)
+- [If a string matches CID_STRICT_PATTERN, it should also match broader patterns.](tests/property/test_cid_core_properties.py:132)
+- [test_combine_base_url_strips_trailing_slash](tests/property/test_link_presenter_properties.py:40)
 - [test_convert_response_json_to_csv_preserves_rows](tests/property/test_response_format_properties.py:45)
+- [Empty date range inputs should be considered valid.](tests/property/test_history_filters_properties.py:205)
+- [The filters property should contain values that can be parsed back.](tests/property/test_history_filters_properties.py:166)
 - [test_decrypt_rejects_modified_payload](tests/property/test_encryption_properties.py:32)
+- [test_dedupe_removes_duplicates_and_preserves_first_seen_order](tests/property/test_entity_references_properties.py:32)
 - [Round-tripping embedded CID components preserves the content.](tests/property/test_cid_properties.py:57)
 - [test_encrypt_decrypt_round_trip](tests/property/test_encryption_properties.py:10)
+- [Extension detection should be case-insensitive.](tests/property/test_mime_utils_properties.py:201)
+- [For known extensions, converting to MIME and back should be stable.](tests/property/test_mime_utils_properties.py:83)
+- [Filename extraction should handle various path formats correctly.](tests/property/test_mime_utils_properties.py:108)
+- [Invalid or edge case paths should return None.](tests/property/test_mime_utils_properties.py:191)
+- [Formatting None should return empty string.](tests/property/test_history_filters_properties.py:101)
+- [Formatted timestamps should not include timezone suffix (always UTC).](tests/property/test_history_filters_properties.py:187)
+- [test_generate_field_id_produces_unique_ids](tests/property/test_formdown_renderer_properties.py:16)
 - [Round-tripping hashed CID components preserves the digest.](tests/property/test_cid_properties.py:43)
+- [The same file structure should parse identically regardless of boundary length.](tests/property/test_hrx_parser_properties.py:116)
+- [HRX parser should handle empty files correctly.](tests/property/test_hrx_parser_properties.py:167)
+- [Invalid HRX archives should raise HRXParseError.](tests/property/test_hrx_parser_properties.py:154)
+- [HRX parser should handle multiple files correctly.](tests/property/test_hrx_parser_properties.py:190)
+- [Parsing an HRX archive should preserve file paths and content.](tests/property/test_hrx_parser_properties.py:72)
+- [Parsed file paths should be safe (no directory traversal).](tests/property/test_hrx_parser_properties.py:139)
+- [Parsed memory sizes should always be positive integers.](tests/property/test_cli_args_properties.py:177)
+- [1024 bytes should equal 1K.](tests/property/test_cli_args_properties.py:119)
+- [Different formatting variations should parse to the same value.](tests/property/test_cli_args_properties.py:96)
+- [Invalid input strings should raise ValueError.](tests/property/test_cli_args_properties.py:147)
+- [1024K should equal 1M.](tests/property/test_cli_args_properties.py:130)
+- [Negative values should raise ValueError.](tests/property/test_cli_args_properties.py:167)
+- [Parsing floating point memory sizes should produce correct byte counts.](tests/property/test_cli_args_properties.py:69)
+- [Parsing should handle various capitalizations consistently.](tests/property/test_cli_args_properties.py:189)
+- [Parsing integer memory sizes should produce correct byte counts.](tests/property/test_cli_args_properties.py:46)
+- [Zero or negative values should be handled correctly.](tests/property/test_cli_args_properties.py:155)
+- [MIME type extraction should ignore charset and other parameters.](tests/property/test_mime_utils_properties.py:95)
+- [MIME type detection should work with various path formats.](tests/property/test_mime_utils_properties.py:141)
+- [Paths without extensions should return default MIME type.](tests/property/test_mime_utils_properties.py:159)
+- [Unknown extensions should return default MIME type.](tests/property/test_mime_utils_properties.py:174)
 - [test_model_to_dict_preserves_values](tests/property/test_serialization_properties.py:33)
 - [Literal patterns should always normalise to a clean, slash-prefixed path.](tests/property/test_alias_matching_properties.py:16)
+- [Normalization should handle None and empty strings gracefully.](tests/property/test_cid_core_properties.py:222)
+- [Normalizing a component multiple times should yield the same result.](tests/property/test_cid_core_properties.py:77)
+- [Normalization should return empty string for paths with internal slashes.](tests/property/test_cid_core_properties.py:112)
+- [Normalization should strip leading slashes.](tests/property/test_cid_core_properties.py:100)
+- [Normalization should strip leading and trailing whitespace.](tests/property/test_cid_core_properties.py:88)
+- [test_normalize_local_path_adds_leading_slash](tests/property/test_entity_references_properties.py:24)
+- [test_normalize_local_path_rejects_urls_with_schemes](tests/property/test_entity_references_properties.py:9)
+- [Normalization should preserve valid CID components without slashes.](tests/property/test_cid_core_properties.py:235)
+- [test_normalize_segment_is_idempotent](tests/property/test_link_presenter_properties.py:9)
+- [Invalid date strings should be marked as invalid.](tests/property/test_history_filters_properties.py:148)
+- [parse_date_range should handle any pair of inputs gracefully.](tests/property/test_history_filters_properties.py:113)
+- [Valid date range should parse correctly.](tests/property/test_history_filters_properties.py:128)
+- [Empty or None timestamps should return None.](tests/property/test_history_filters_properties.py:83)
+- [Invalid timestamp strings should return None.](tests/property/test_history_filters_properties.py:93)
+- [test_render_attribute_boolean_only_emits_when_truthy](tests/property/test_formdown_renderer_properties.py:23)
+- [test_render_attribute_escapes_non_boolean_values](tests/property/test_formdown_renderer_properties.py:65)
+- [test_render_formdown_html_escapes_paragraph_text](tests/property/test_formdown_renderer_properties.py:40)
+- [test_server_path_treats_servers_prefix_as_optional](tests/property/test_link_presenter_properties.py:25)
 - [test_server_roundtrip_equivalence](tests/property/test_db_equivalence_property.py:21)
+- [Strings shorter than minimum reference length should not match CID patterns.](tests/property/test_cid_core_properties.py:210)
+- [test_strip_extension_only_strips_from_last_segment](tests/property/test_entity_references_properties.py:58)
+- [Formatting twice should yield the same result.](tests/property/test_history_filters_properties.py:218)
+- [Formatting a datetime and parsing it back should yield the original value.](tests/property/test_history_filters_properties.py:44)
+- [All timestamps should be normalized to UTC.](tests/property/test_history_filters_properties.py:62)
 - [test_value_to_xml_produces_parseable_documents](tests/property/test_response_format_properties.py:29)
 
 ## Gauge Tests

Error: TEST_INDEX.md is out of date!
Please run &#x27;python generate_test_index.py&#x27; and commit the changes.
</pre>
</body>
</html>